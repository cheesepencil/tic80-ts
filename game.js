var __extends=this&&this.__extends||function(){var e=function(t,i){return(e=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,i){t.__proto__=i}:function(t,i){for(var e in i)Object.prototype.hasOwnProperty.call(i,e)&&(t[e]=i[e])}))(t,i)}
return function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null")
function __(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(__.prototype=i.prototype,new __)}}()
var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(t){for(var i,e=1,n=arguments.length;e<n;e++)for(var r in i=arguments[e])Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])
return t}).apply(this,arguments)}
var Scene=function(){var t=this
this.init=function(){},this.update=function(){},this.draw=function(){},this.initialized=!1,this.TIC=function(){t.initialized||(t.init(),t.initialized=!0),t.update(),t.draw()}}
var EasingScene=function(t){function EasingScene(){var e=null!==t&&t.apply(this,arguments)||this
return e.sprites=[],e.tweens=[],e.init=function(){var t=new PlatformerSprite({x:0,y:32,heightSprites:2,widthSprites:2,index:1,colorKey:14})
e.sprites.push(t)
var i=new PositionTween({target:t,durationFrames:Util.secondsToFrames(2),delayFrames:Util.secondsToFrames(.5),startX:0,endX:224,easing:Easing.easeInOutElastic,yoyo:!0,repeat:-1})
e.tweens.push(i),t=new PlatformerSprite({x:0,y:96,heightSprites:2,widthSprites:2,index:1,colorKey:14}),e.sprites.push(t),i=new PositionTween({target:t,durationFrames:Util.secondsToFrames(2),delayFrames:Util.secondsToFrames(.5),startX:0,endX:224,easing:Easing.easeInOutQuad,yoyo:!0,repeat:-1}),e.tweens.push(i)},e.update=function(){e.tweens.map(function(t){return t.TIC()})},e.draw=function(){cls(13),e.sprites.map(function(t){return t.draw()})},e}return __extends(EasingScene,t),EasingScene}(Scene)
var PlatformerScene=function(i){function PlatformerScene(){var t=null!==i&&i.apply(this,arguments)||this
return t.init=function(){t.platformerSprite=new PlatformerSprite({x:180,y:100,heightSprites:2,widthSprites:2,index:1,colorKey:0})},t.update=function(){t.platformerSprite&&t.platformerSprite.update()},t.draw=function(){map(0,0),t.platformerSprite&&t.platformerSprite.draw()},t}return __extends(PlatformerScene,i),PlatformerScene}(Scene)

;// title:  game title
// author: game developer
// desc:   short description
// script: js
var demoScene=new PlatformerScene
function TIC(){demoScene.TIC()}var Collision=function(){function Collision(){}return Collision.intersectsPointBox=function(t,i){var e=!1
return e=Math.floor(t.x)>=Math.floor(i.x)&&Math.floor(t.x)<Math.floor(i.x+i.w)&&Math.floor(t.y)>=Math.floor(i.y)&&Math.floor(t.y)<Math.floor(i.y+i.h)?!0:e},Collision.intersectsBoxBox=function(t,i){var e=t.x-i.x
var n=.5*t.w+.5*i.w
return!(Math.abs(e)>=n||(e=t.y-i.y,n=.5*t.h+.5*i.y,Math.abs(e)>-n))},Collision.collideSideMap=function(t,i){var e=t.h/3
for(var n=-e;n<=e;n+=2){var r=t.x/8
var o
var s=(t.y+t.h/2+n)/8
r=mget(r,s)
if(fget(r,i))return t.dx=0,t.x=8*Math.floor(t.x/8)+8,!0
if(s=t.x+t.w,o=t.y+t.h/2+n,r=mget(s/8,o/8),fget(r,i))return t.dx=0,t.x=8*Math.floor(s/8)-t.w,!0}return!1},Collision.collideFloorMap=function(t,i){if(t.dy<0)return!1
var e=t.w/3
var n=!1
for(var r=-e;r<=e;r+=2){var o=(t.x+t.w/2+r)/8
var s=(t.y+t.h)/8
o=mget(o,s)
fget(o,i)&&(t.dy=0,t.y=8*Math.floor((t.y+t.h)/8)-t.h,t.grounded=!0,n=!(t.airTime=0))}return n},Collision.collideRoofMap=function(t,i){var e=t.w/3
for(var n=-e;n<=e;n+=2){var r=t.x+t.w/2+n
var o=t.y
r=mget(r/8,o/8)
fget(r,i)&&(t.dy=0,t.y=8*Math.floor(t.y/8)+8,t.jumpHoldTime=0)}},Collision}()
var Easing=function(){function Easing(){}return Easing.linear=function(t){return t},Easing.easeInQuad=function(t){return t*t},Easing.easeOutQuad=function(t){return 1- --t*t},Easing.easeInOutQuad=function(t){return t<.5?t*t*2:1- --t*t*2},Easing.easeOutInQuad=function(t){return t<.5?.5-(t-=.5)*t*2:.5+(t-=.5)*t*2},Easing.easeInQuart=function(t){return t*t*t*t},Easing.easeOutQuart=function(t){return 1- --t*t*t*t},Easing.easeInOutQuart=function(t){return t<.5?8*t*t*t*t:1-8*--t*t*t*t},Easing.easeOutInQuart=function(t){return t<.5?.5-8*(t-=.5)*t*t*t:.5+8*(t-=.5)*t*t*t},Easing.easeInOvershoot=function(t){return 2.7*t*t*t-1.7*t*t},Easing.easeOutOvershoot=function(t){return 1+2.7*--t*t*t+1.7*t*t},Easing.easeInOutOvershoot=function(t){return t<.5?(21.6*t*t*t-6.8*t*t)/2:1+(21.6*--t*t*t+6.8*t*t)/2},Easing.easeOutInOvershoot=function(t){return t<.5?(21.6*(t-=.5)*t*t+6.8*t*t)/2+.5:(21.6*(t-=.5)*t*t-6.8*t*t)/2+.5},Easing.easeInElastic=function(t){return 0==t?0:Math.pow(2,10*t-10)*Util.picoCos(2*t-2)},Easing.easeOutElastic=function(t){return 1==t?1:1-Math.pow(2,-10*t)*Util.picoCos(2*t)},Easing.easeInOutElastic=function(t){return t<.5?Math.pow(2,20*t-10)*Util.picoCos(4*t-2)/2:(t-=.5,1-Math.pow(2,-20*t)*Util.picoCos(4*t)/2)},Easing.easeOutInElastic=function(t){return t<.5?.5-Math.pow(2,-20*t)*Util.picoCos(4*t)/2:(t-=.5,Math.pow(2,20*t-10)*Util.picoCos(4*t-2)/2+.5)},Easing.easeInBounce=function(t){var i=7.5625
var e=2.75
return(t=1-t)<1/e?1-i*t*t:t<2/e?1-i*(t-=1.5/e)*t-.75:t<2.5/e?1-i*(t-=2.25/e)*t-.9375:1-i*(t-=2.625/e)*t-.984375},Easing.easeOutBounce=function(t){var i=7.5625
var e=2.75
return t<1/e?i*t*t:t<2/e?i*(t-=1.5/e)*t+.75:t<2.5/e?i*(t-=2.25/e)*t+.9375:i*(t-=2.625/e)*t+.984375},Easing}()
var PlatformerSpriteButton=function(){function PlatformerSpriteButton(t){this.isPressed=!1,this.isDown=!1,this.ticksDown=0,this.jumpBtn=t}return PlatformerSpriteButton.prototype.update=function(){this.isPressed=!1,btn(this.jumpBtn)?(this.isDown||(this.isPressed=!0),this.isDown=!0,this.ticksDown+=1):(this.isDown=!1,this.isPressed=!1,this.ticksDown=0)},PlatformerSpriteButton}()
var PlatformerSprite=function(){function PlatformerSprite(t){this.dx=0,this.dy=0,this.dxMax=1,this.dyMax=4,this.jumpSpeed=-1.5,this.acc=.1,this.dcc=.25,this.airDcc=1,this.grav=.15,this.jumpHoldTime=0,this.maxJumpPress=15,this.jumpBtnReleased=!0,this.grounded=!1,this.airTime=0,this.flipX=!1,this.x=t.x||0,this.y=t.y||0,this.widthSprites=t.widthSprites||1,this.w=8*this.widthSprites,this.heightSprites=t.heightSprites||1,this.h=8*this.heightSprites,this.index=t.index,this.colorKey=t.colorKey,this.jumpButton=new PlatformerSpriteButton(t.jumpButton||4)}return PlatformerSprite.prototype.update=function(){var t=btn(2)
var i=!t&&btn(3)
var e,n
t?this.dx-=this.acc:i?this.dx+=this.acc:this.grounded?this.dx*=this.dcc:this.dx*=this.airDcc,this.dx=Util.clamp(this.dx,-this.dxMax,this.dxMax),this.x+=this.dx,Collision.collideSideMap(this,1),this.jumpButton.update(),this.jumpButton.isDown?(e=this.grounded||this.airTime<5,n=this.jumpButton.ticksDown<10,trace("jumpHoldTime: ".concat(this.jumpHoldTime,", onGround: ").concat(e,", newJumpBtn: ").concat(n)),(0<this.jumpHoldTime||e&&n)&&(this.jumpHoldTime,this.jumpHoldTime+=1,this.jumpHoldTime<this.maxJumpPress)&&(this.dy=this.jumpSpeed)):this.jumpHoldTime=0,this.dy+=this.grav,this.dy=Util.clamp(this.dy,-this.dyMax,this.dyMax),this.y+=this.dy,Collision.collideFloorMap(this,1)||(this.grounded=!1,this.airTime+=1),Collision.collideRoofMap(this,1),this.grounded&&(i||t)&&this.dx,this.flipX=!i},PlatformerSprite.prototype.draw=function(){spr(this.index,this.x,this.y,this.colorKey,1,this.flipX?1:0,0,this.widthSprites,this.heightSprites)
var t=this.h/3
for(var i=-t;i<=t;i+=2){var e=this.x
var n=this.y+this.h/2+i
pix(e,n,6)}},PlatformerSprite}()
var PositionTween=function(){function PositionTween(t){this.frameCounter=0,this.frameCounterIncrement=1,this.delayCompleted=!1,this.done=!1,this.repeatCounter=0,this.paused=!1,this.config=__assign(__assign({},t),{delayFrames:t.delayFrames?Math.floor(t.delayFrames):0,repeat:t.repeat?Math.floor(t.repeat):0,yoyo:t.yoyo||!1,easing:t.easing||Easing.linear,callback:t.callback||function(){}})}return PositionTween.prototype.getAbsoluteProgress=function(){var t=this.frameCounter/this.config.durationFrames
return t=Math.min(t,1),Math.max(t,0)},PositionTween.prototype.getEasedProgress=function(){var t=this.getAbsoluteProgress()
return this.config.easing(t)},PositionTween.prototype.TIC=function(){var t,i
this.done||this.paused||(!this.delayCompleted&&this.frameCounter>=this.config.delayFrames&&(this.delayCompleted=!0,this.frameCounter=0),this.delayCompleted&&(t=this.getAbsoluteProgress(),i=this.getEasedProgress(),void 0!==this.config.startX&&void 0!==this.config.endX&&(this.config.target.x=Util.lerp(this.config.startX,this.config.endX,i)),void 0!==this.config.startY&&void 0!==this.config.endY&&(this.config.target.y=Util.lerp(this.config.startY,this.config.endY,i)),0<this.frameCounterIncrement&&1===t?this.config.yoyo?this.frameCounterIncrement=-1:(this.repeatCounter++,this.frameCounter=0):this.frameCounterIncrement<0&&0===t&&(this.repeatCounter++,this.frameCounterIncrement=1),0<=this.config.repeat)&&this.repeatCounter>this.config.repeat&&(this.config.callback(),this.done=!0),this.frameCounter+=this.frameCounterIncrement)},PositionTween.prototype.setPaused=function(t){this.paused=t},PositionTween}()
var Util=function(){function Util(){}
// Simulates PICO-8's sin(), which takes "turns" as input instead of rads
return Util.picoSin=function(t){t*=2*Math.PI
return-Math.sin(t)},
// Simulates PICO-8's cos(), which takes "turns" as input instead of rads
Util.picoCos=function(t){t*=2*Math.PI
return Math.cos(t)},Util.clamp=function(t,i,e){return Math.min(Math.max(t,i),e)},Util.round=function(t){return Math.floor(t+.5)},Util.secondsToFrames=function(t){return Math.floor(60*t)},Util.lerp=function(t,i,e){return t+(i-t)*e},Util.invlerp=function(t,i,e){return i-t==0?0:(e-t)/(i-t)},Util}()
var Vector=function(){function Vector(t,i){var e=this
this.getLength=function(){return Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2))},this.x=t,this.y=i}return Vector.prototype.getNormal=function(){var t=this.getLength()
return new Vector(this.x/t,this.y/t)},Vector}()

// <TILES>
// 001:e2222222228888882aaaaaaa2a8888882acccccc2acc0ccc2acc0ccc2acc0ccc
// 002:ccccceee8888cceeaaaa0cee888a0ceeccca0ccc0cca0c0c0cca0c0c0cca0c0c
// 003:eccccccccc888888caaaaaaaca888888cacccccccacccccccacc0ccccacc0ccc
// 004:ccccceee8888cceeaaaa0cee888a0ceeccca0cccccca0c0c0cca0c0c0cca0c0c
// 016:1112111111121111111121111111211111121111111211111111211111112111
// 017:cacccccccaaaaaaacaaacaaacaaaaccccaaaaaaac8888888cc000cccecccccec
// 018:ccca00ccaaaa0ccecaaa0ceeaaaa0ceeaaaa0cee8888ccee000cceeecccceeee
// 019:cacccccccaaaaaaacaaacaaacaaaaccccaaaaaaac8888888cc000cccecccccec
// 020:ccca00ccaaaa0ccecaaa0ceeaaaa0ceeaaaa0cee8888ccee000cceeecccceeee
// 032:2222222212121212212121211211121111111111111211111111111111111111
// 048:0003330000033300000030002003333320033300000333300003003000033033
// </TILES>

// <MAP>
// 000:010202020202020202020202020202020202020202020202020202020201000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
// 001:010000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
// 002:010000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
// 003:010000000000000000000000000000000000000000000000010000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
// 004:010000000000000000000000000000000000000100000000010000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
// 005:010000000000000000000000000001000000000100000000010000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
// 006:010000000000000000010000000001000000000100000000010000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
// 007:010000000100000000010000000001000000000100000000010000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
// 008:010202020202020202020202020202020202020202020202020202020201000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
// 009:010000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
// 010:010000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
// 011:010000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
// 012:010000000000000000000000000000000000000100000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
// 013:010000000000000000000000000001000000000100000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
// 014:010000000000000000010000000001000000000100000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
// 015:010000000100000000010000000001000000000100000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
// 016:010202020202020202020202020202020202020202020202020202020201000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
// </MAP>

// <WAVES>
// 000:00000000ffffffff00000000ffffffff
// 001:0123456789abcdeffedcba9876543210
// 002:0123456789abcdef0123456789abcdef
// </WAVES>

// <SFX>
// 000:000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000304000000000
// </SFX>

// <FLAGS>
// 000:00000000000000000000000000000000200000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
// </FLAGS>

// <PALETTE>
// 000:1a1c2c5d275db13e53ef7d57ffcd75a7f07038b76425717929366f3b5dc941a6f673eff7f4f4f494b0c2566c86333c57
// </PALETTE>

